!function(){"use strict";var t={chatListClass:"",chatElementClass:"",bubbleListClass:"",bubbleElementClass:"",inputContainerClass:"",inputBoxClass:"",inputButtonClass:"",previousResponsePattern:"{{previousResponse}}"},e={userInputSubmit:"fm-user-input-submit",userInputKeyChange:"fm-user-input-key-change",userInputUpdate:"fm-user-input-update",flowUpdate:"fm-flow-update"},n=function(t){this.element=t};n.isTagValid=function(t){return!t.hasAttribute("fm-disabled")&&(!(["hidden","submit","button"].indexOf(t.getAttribute("type"))>=0)&&(!(["true","disabled"].indexOf(t.getAttribute("disabled"))>=0)&&"button"!=t.tagName))},n.isTagGroup=function(t){return["radio","checkbox"].indexOf(t.getAttribute("type"))>=0},n.prototype.getQuestion=function(){return this.questions||(this.questions=[],this.element.getAttribute("fm-questions")&&(this.questions=this.element.getAttribute("fm-questions").split("|")),this.questions.length<=0&&this.questions.push("Please provide us your "+this.element.getAttribute("name"))),this.questions[Math.floor(Math.random()*this.questions.length)].trim()},n.prototype.setInputValue=function(t){this.element.value=t},n.prototype.isInputSensitive=function(){return"password"==this.element.getAttribute("type")},n.prototype.getPlaceHolder=function(){return this.element.getAttribute("placeholder")};var i=function(t){this.attrName=t,this.elements=[]};i.prototype.addElement=function(t){this.elements.push(t)};var s=function(t){return this.step=0,this.maxSteps=t.tags.length,this.tags=t.tags,this.fmReference=t.fmReference,this.userInputSubmitCallback=this.userInputSubmit.bind(this),document.addEventListener(e.userInputSubmit,this.userInputSubmitCallback,!1),this.userInputKeyChangeCallback=this.userInputKeyChange.bind(this),document.addEventListener(e.userInputKeyChange,this.userInputKeyChangeCallback,!1),this};Object.defineProperty(s.prototype,"currentTag",{get:function(){return this.tags[this.step]},enumerable:!0,configurable:!0}),s.prototype.start=function(){this.processStep()},s.prototype.nextStep=function(){this.step++,this.processStep()},s.prototype.processStep=function(){this.step==this.maxSteps?this.fmReference.doSubmitForm():(this.step%=this.maxSteps,this.showStep())},s.prototype.showStep=function(){var t=this;document.dispatchEvent(new CustomEvent(e.flowUpdate,{detail:t.currentTag}))},s.prototype.userInputSubmit=function(t){var i=this,s=t.detail.trim();if(this.currentTag instanceof n){if(this.currentTag.setInputValue(s),this.currentTag.isInputSensitive()){for(var u="",r=0;r<s.length;r++)u+="*";s=u}document.dispatchEvent(new CustomEvent(e.userInputUpdate,{detail:s})),setTimeout(function(){return i.nextStep()},250)}},s.prototype.userInputKeyChange=function(t){this.currentTag instanceof i&&console.log("Bubble changed")};var u=function(n){return this.fmReference=n,this.el=document.createElement("div"),this.el.id="fmChatList",this.el.className=t.chatListClass.trim(),this.onUserInputUpdateCallback=this.onUserInputUpdate.bind(this),document.addEventListener(e.userInputUpdate,this.onUserInputUpdateCallback,!1),this};u.prototype.onUserInputUpdate=function(t){this.buildUserChatElement(t.detail),this.fmReference.setCurrentResponse(t.detail)},u.prototype.buildUserChatElement=function(e){var n=document.createElement("div");n.className=("fm-chat-element fm-user fm-clearfix"+t.chatElementClass).trim(),n.textContent=e,this.el.appendChild(n)},u.prototype.buildBotChatElement=function(e){var n=document.createElement("div");n.className=("fm-chat-element fm-bot fm-clearfix"+t.chatElementClass).trim(),n.textContent=e,this.el.appendChild(n)};var r=function(e){return this.fmReference=e,this.el=document.createElement("div"),this.el.id="fmBubbleList",this.el.className=t.bubbleListClass.trim(),this},o=function(e){return this.fmReference=e,this.disabled=!1,this.el=document.createElement("div"),this.el.id="fmInputContainer",this.el.className=t.inputContainerClass.trim(),this.inputEl=document.createElement("input"),this.inputEl.type="text",this.inputEl.id="fmInputBox",this.inputEl.className=t.inputBoxClass.trim(),this.inputBtnEl=document.createElement("button"),this.inputBtnEl.type="button",this.inputBtnEl.id="fmInputBtn",this.inputBtnEl.innerHTML="Send",this.inputBtnEl.className=t.inputButtonClass.trim(),this.el.appendChild(this.inputEl),this.el.appendChild(this.inputBtnEl),this.onKeyUpCallback=this.onKeyUp.bind(this),this.inputEl.addEventListener("keyup",this.onKeyUpCallback,!1),this.onEnterOrSubmitBtnCallback=this.onEnterOrSubmitBtn.bind(this),this.inputBtnEl.addEventListener("click",this.onEnterOrSubmitBtnCallback,!1),this};o.prototype.onKeyUp=function(t){var n=this;return!this.disabled&&void(13==t.keyCode?this.onEnterOrSubmitBtn():document.dispatchEvent(new CustomEvent(e.userInputKeyChange,{detail:n.inputEl.value})))},o.prototype.onEnterOrSubmitBtn=function(){var t=this;return!this.disabled&&void document.dispatchEvent(new CustomEvent(e.userInputSubmit,{detail:t.inputEl.value}))},o.prototype.hideUserInput=function(t){t?this.inputEl.setAttribute("type","password"):this.inputEl.setAttribute("type","text")},o.prototype.setPlaceHolder=function(t){this.inputEl.setAttribute("placeholder",t)},o.prototype.setInputGroup=function(t){t?this.inputBtnEl.style.display="none":(this.inputEl.focus(),this.inputBtnEl.style.display=null)},o.prototype.clearInput=function(){this.inputEl.value=""},o.prototype.setDisabled=function(t){this.disabled=!!t,t?(this.inputEl.setAttribute("disabled","disabled"),this.inputBtnEl.setAttribute("disabled","disabled")):(this.inputEl.removeAttribute("disabled"),this.inputBtnEl.removeAttribute("disabled"))};var l=function(n){if(!n.formEl)throw new Error("Conversational Form error, the formEl needs to be defined.");var i=this;this.options=Object.assign({},t,n),this.formEl=n.formEl,this.containerEl=n.containerEl?n.containerEl:document.body,this.tags=[],this.currentResponse="",this.buildUI(),this.onFlowUpdateCallback=this.onFlowUpdate.bind(this),document.addEventListener(e.flowUpdate,this.onFlowUpdateCallback,!1),setTimeout(function(){return i.initForm(n.formEl)},0)};l.prototype.initForm=function(t){this.formEl=t;for(var e=[].slice.call(this.formEl.querySelectorAll("input, button"),0),u={},r=0;r<e.length;r++){var o=e[r];if(n.isTagValid(o))if(n.isTagGroup(o)){var l=o.getAttribute("name");if(!u.hasOwnProperty(l)){var a=new i(l);u[l]=a}u[l].addElement(o)}else this.tags.push(new n(o))}this.flowManager=new s({fmReference:this,tags:this.tags}).start()},l.prototype.buildUI=function(){this.el=document.createElement("div"),this.el.id="form-messenger",this.containerEl.appendChild(this.el),this.chatEl=new u(this),this.el.appendChild(this.chatEl.el),this.bubbleEl=new r(this),this.el.appendChild(this.bubbleEl.el),this.userInput=new o(this),this.el.appendChild(this.userInput.el)},l.prototype.onFlowUpdate=function(e){var n=e.detail,s=n.getQuestion().split(t.previousResponsePattern).join(this.currentResponse);this.chatEl.buildBotChatElement(s),this.userInput.hideUserInput(n.isInputSensitive()),this.userInput.setPlaceHolder(n.getPlaceHolder()),this.userInput.setInputGroup(this.currentTag instanceof i)},l.prototype.doSubmitForm=function(){this.chatEl.buildBotChatElement("Sending form..."),this.userInput.setDisabled(!0);var t=[].slice.call(this.formEl.querySelectorAll("input, button"),0);if(t.length>0)for(var e=0;e<t.length;e++)"submit"==t[e].getAttribute("type")&&t[e].click();else this.formEl.submit()},l.prototype.setCurrentResponse=function(t){this.userInput.clearInput(),this.currentResponse=t},window.addEventListener("load",function(){var t=document.querySelector("#fm-initiator"),e=document.querySelector("#fm-container");t&&(window.FormMessenger=new l({formEl:t,containerEl:e}))})}();